NNTR = no need to repeat (if done once, should persist on my VM)

== Upgrade MediaWiki ==

=== Update PHP (NNTR) ===

* Assume you are starting with PHP 7.0 (NNTR)

* install mbstring with `apt-get install php7.0-mbstring` (NNTR)

* restart nginx and php7.0-fpm (NNTR)

=== Get basic MediaWiki setup in place ===

* Create folder ~/software/mediawiki/1.29 (NNTR)

* Run `wget https://releases.wikimedia.org/mediawiki/1.29/mediawiki-1.29.2.tar.gz` in that folder (NNTR)

* Run `tar -xvzf mediawiki-1.29.2.tar.gz` in that folder (NNTR)

* Create new copy ~/mediawiki/<project>-new/ with subfolders w/ and logs/ and copy ~/software/mediawiki/1.29/mediawiki-1.29.2/ into the subfolder w/

* Also touch logs/access.log and logs/error.log

* Copy over ~/mediawiki/<project>/w/LocalSettings.php to ~/mediawiki/<project>-new/w/LocalSettings.php

* Copy over ~/mediawiki/<project>/w/extensions/ to ~/mediawiki/<project>-new/w/extensions/

* Copy over images if you have any (TBF)

* Add the following in ~/mediawiki/<project>-new/w/LocalSettings.php

wfLoadSkin( 'CologneBlue' );
wfLoadSkin( 'Modern' );
wfLoadSkin( 'MonoBook' );
wfLoadSkin( 'Vector' );

* Go to ~/mediawiki/<project>/w/maintenance and run `php7.0 update.php`

* Turn off Semantic MediaWiki (since that needs separate upgrading)

=== Nginx ===

* Change <project>/ to <project>-new/ in the nginx config

* Restart Nginx and PHP7.0-FPM

=== Scribunto ===

* Create ~/software/mediawiki/extensions/scribunto/ (NNTR)

* In there, run git clone git@github.com:wikimedia/mediawiki-extensions-Scribunto.git (NNTR)

* Switch to branch REL1_29 (NNTR)

* mkdir ~/mediawiki/<project>-new/w/extensions/Scribunto

* In Scribunto, cp -r ~/software/mediawiki/extensions/scribunto/mediawiki-extensions-Scribunto/* ./

* chmod a+x ~/mediawiki/<project>-new/w/extensions/Scribunto/engines/LuaStandalone/binaries/lua5_1_5_linux_64_generic/lua

* Add these two lines in ~/mediawiki/<project>-new/w/extensionlist.inc

require_once("extensions/Scribunto/Scribunto.php");
$wgScribuntoDefaultEngine = 'luastandalone';

* Go check that things are still running

=== ParserFunctions ===

* Create ~/software/mediawiki/extensions/ParserFunctions/ (NNTR)

* In there, run git clone git@github.com:wikimedia/mediawiki-extensions-ParserFunctions.git (NNTR)

* Switch to branch REL1_29 (NNTR)

* Empty out if already present ~/mediawiki/<project>-new/w/extensions/ParserFunctions

* In ParserFunctions, cp -r ~/software/mediawiki/extensions/ParserFunctions/mediawiki-extensions-ParserFunctions/* ./

* In ~/mediawiki/<project>-new/w/extensionlist.inc, add the line:

wfLoadExtension( 'ParserFunctions' );

=== Cite ===

* Create ~/software/mediawiki/extensions/Cite/ (NNTR)

* In there, run git clone git@github.com:wikimedia/mediawiki-extensions-Cite.git (NNTR)

* Switch to branch REL1_29 (NNTR)

* Empty out if already present ~/mediawiki/<project>-new/w/extensions/Cite

* In Cite, cp -r ~/software/mediawiki/extensions/Cite/mediawiki-extensions-Cite/* ./

* In ~/mediawiki/<project>-new/w/extensionlist.inc, add the line:

wfLoadExtension( 'Cite' );

=== MobileFrontend ===

* Create ~/software/mediawiki/extensions/MobileFrontend/ (NNTR)

* In there, run git clone git@github.com:wikimedia/mediawiki-extensions-MobileFrontend.git (NNTR)

* Switch to branch REL1_29 (NNTR)

* Empty out if already present ~/mediawiki/<project>-new/w/extensions/MobileFrontend

* In MobileFrontend, cp -r ~/software/mediawiki/extensions/MobileFrontend/mediawiki-extensions-MobileFrontend/* ./

* In ~/mediawiki/<project>-new/w/extensionlist.inc, add the line:

wfLoadExtension( 'MobileFrontend' );
$wgMFAutodetectMobileView = true;

=== Math ===

* Create ~/software/mediawiki/extensions/Math/ (NNTR)

* In there, run git clone git@github.com:wikimedia/mediawiki-extensions-Math.git (NNTR)

* Switch to branch REL1_29 (NNTR)

* Empty out if already present ~/mediawiki/<project>-new/w/extensions/Math

* In Math, cp -r ~/software/mediawiki/extensions/Math/mediawiki-extensions-Math/* ./

* In ~/mediawiki/<project>-new/w/mathsettings.inc, add the line:

wfLoadExtension( 'Math' );

=== Upgrade Semantic MediaWiki ===

(Still not done)

* wget SMW 1.8.0.5 (NNTR) and put in ~/software/mediawiki/extensions/semanticmediawiki/1.8.0.5/ and rename to something without spaces

* `tar -xvzf <downloaded>`

* Delete your old SemanticMediaWiki/ and Validator/ in ~/mediawiki/<project>-new/w/extensions/ and copy the new SemanticMediaWiki/ and Validator/ into that

* Update ~/mediawiki/<project>-new/w/semanticsettings.inc adding the line `$smwgDefaultStore = 'SMWSQLStore2';` as per https://www.semantic-mediawiki.org/wiki/Help:Installation_1.8.0#Upgrading_existing_installations

* Go to ~/mediawiki/devec-new/w/extensions/SemanticMediaWiki/maintenance and run `php7.0 SMW_setup.php -b SMWSQLStore3`
